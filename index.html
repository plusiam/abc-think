<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC ìƒê°ë°”ê¾¸ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .font-gowun { font-family: 'Gowun Dodum', serif; }

        @media print {
            body * { visibility: hidden; }
            #printableArea, #printableArea * { visibility: visible; }
            #printableArea {
                position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 20px;
                border: none !important; box-shadow: none !important;
            }
            .no-print { display: none !important; }
            #resultContentForPrint { box-shadow: none !important; border-top: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6">

    <div class="w-full max-w-3xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-10 space-y-8 border-t-8 border-green-600">
            <header class="text-center">
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">ABC ìƒê°ë°”ê¾¸ê¸°</h1>
                <p class="text-gray-600 mt-2">ë‚˜ì˜ ìƒê°ì„ ëŒì•„ë³´ë©° ë§ˆìŒì„ ê±´ê°•í•˜ê²Œ ì¡°ì ˆí•˜ëŠ” ë²•ì„ ë°°ì›Œìš”.</p>
            </header>

            <form id="abcForm" class="space-y-8">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 bg-gray-50 p-4 rounded-lg shadow-sm">
                    <div>
                        <label for="schoolName" class="font-semibold text-gray-700">í•™êµ</label>
                        <input type="text" id="schoolName" name="schoolName" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ì˜ˆ: ë§ˆìŒì´ˆë“±í•™êµ">
                    </div>
                    <div>
                        <label for="className" class="font-semibold text-gray-700">í•™ë…„/ë°˜</label>
                        <input type="text" id="className" name="className" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ì˜ˆ: 5í•™ë…„ 1ë°˜">
                    </div>
                    <div>
                        <label for="studentName" class="font-semibold text-gray-700">ì´ë¦„</label>
                        <input type="text" id="studentName" name="studentName" class="mt-1 w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ì˜ˆ: í™ê¸¸ë™">
                    </div>
                </div>

                <div>
                    <label for="situation" class="text-xl font-semibold text-gray-800 block mb-2">ğŸ¤” 1. ì–´ë–¤ ìƒí™©ì´ì—ˆë‚˜ìš”?</label>
                    <textarea id="situation" name="situation" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ìµœê·¼ ë‚˜ë¥¼ í˜ë“¤ê²Œ í–ˆë˜ ìƒí™©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì ì–´ë³´ì„¸ìš”."></textarea>
                </div>

                <div>
                    <label class="text-xl font-semibold text-gray-800 block mb-3">ğŸ§ 2. ê·¸ ìƒí™©ì€ ë‚´ê°€ ë°”ê¿€ ìˆ˜ ìˆë‚˜ìš”?</label>
                    <div class="flex flex-col sm:flex-row gap-x-6 gap-y-3 bg-gray-50 p-4 rounded-lg shadow-sm">
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="control" value="ë°”ê¿€ ìˆ˜ ìˆëŠ” ê²ƒ" class="text-green-600 focus:ring-green-500 h-4 w-4"><span>âœ… ë°”ê¿€ ìˆ˜ ìˆëŠ” ê²ƒ (ë‚´ ë§, í–‰ë™, ìƒê° ë“±)</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="control" value="ë°”ê¾¸ê¸° ì–´ë ¤ìš´ ê²ƒ" class="text-green-600 focus:ring-green-500 h-4 w-4"><span>âš ï¸ ë°”ê¾¸ê¸° ì–´ë ¤ìš´ ê²ƒ (ì‹œí—˜ ê²°ê³¼, íƒ€ì¸ì˜ ë°˜ì‘ ë“±)</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="control" value="ë°”ê¿€ ìˆ˜ ì—†ëŠ” ê²ƒ" class="text-green-600 focus:ring-green-500 h-4 w-4"><span>ğŸš« ë°”ê¿€ ìˆ˜ ì—†ëŠ” ê²ƒ (ê³¼ê±°, ë‚ ì”¨, íƒ€ì¸ì˜ ë§ˆìŒ ë“±)</span></label>
                    </div>
                </div>

                <hr class="my-6 border-gray-300">
                <p class="text-center text-gray-600 font-medium">ì´ì œ ê·¸ ìƒí™©ì„ ABCë¡œ ë‚˜ëˆ„ì–´ ë¶„ì„í•´ë³¼ê²Œìš”!</p>
                
                <div>
                    <label for="eventA" class="text-xl font-semibold text-gray-800 block mb-2">A. ì¼ì–´ë‚œ ì‚¬ê±´ (Activating Event)</label>
                    <textarea id="eventA" name="eventA" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ëˆ„ê°€ ë´ë„ ê·¸ë ‡ë‹¤ê³  í•  ìˆ˜ ìˆëŠ” 'ê°ê´€ì ì¸ ì‚¬ì‹¤'ë§Œ ì ì–´ë³´ì„¸ìš”. (ì˜ˆ: ì‹œí—˜ì—ì„œ 3ë¬¸ì œë¥¼ í‹€ë ¸ë‹¤)"></textarea>
                </div>

                <div>
                    <label for="beliefB" class="text-xl font-semibold text-gray-800 block mb-2">B. ë‚˜ì˜ ìƒê° (Belief)</label>
                    <textarea id="beliefB" name="beliefB" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ê·¸ ì‚¬ê±´ì— ëŒ€í•´ ë‚˜ë„ ëª¨ë¥´ê²Œ ë– ì˜¤ë¥¸ 'ìë™ì ì¸ ìƒê°'ì„ ì ì–´ë³´ì„¸ìš”. (ì˜ˆ: ë‚˜ëŠ” ë©ì²­í•´. ì—­ì‹œ ë‚œ ì•ˆë¼.)"></textarea>
                </div>

                <div>
                    <label for="consequenceC" class="text-xl font-semibold text-gray-800 block mb-2">C. ê²°ê³¼ (Consequence)</label>
                    <textarea id="consequenceC" name="consequenceC" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ê·¸ ìƒê° ë•Œë¬¸ì— ì–´ë–¤ ê°ì •ì„ ëŠê¼ˆê³ , ì–´ë–»ê²Œ í–‰ë™í–ˆë‚˜ìš”? (ì˜ˆ: ìŠ¬í¼ì„œ í¬ê¸°í•˜ê³  ì‹¶ì–´ì¡Œë‹¤.)"></textarea>
                </div>
                
                <hr class="my-6 border-gray-300">
                <p class="text-center text-green-700 font-bold text-lg">âœ¨ ì´ì œ, ìƒê°ì„ ë°”ê¾¸ì–´ ìƒˆë¡œìš´ ê²°ê³¼ë¥¼ ë§Œë“¤ì–´ ë³¼ ì‹œê°„ì´ì—ìš”! âœ¨</p>

                <div>
                    <div class="flex items-center gap-4 mb-2">
                        <label for="beliefB_prime" class="text-xl font-semibold text-gray-800">B'. ê±´ê°•í•œ ìƒê° ë°”ê¾¸ê¸°</label>
                        <button type="button" id="hintBtn" class="bg-yellow-400 text-yellow-800 rounded-full w-8 h-8 text-lg font-bold hover:bg-yellow-500 transition flex items-center justify-center shadow">ğŸ’¡</button>
                    </div>
                    <div id="hintBox" class="hidden p-3 mb-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg text-sm"></div>
                    <textarea id="beliefB_prime" name="beliefB_prime" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ìë™ì ì¸ ìƒê°ì„ ë” í˜„ì‹¤ì ì´ê³ , ë‚˜ì—ê²Œ ë„ì›€ì´ ë˜ëŠ” ê±´ê°•í•œ ìƒê°ìœ¼ë¡œ ë°”ê¾¸ì–´ ì ì–´ë³´ì„¸ìš”."></textarea>
                </div>
                
                <div>
                    <label for="consequenceC_prime" class="text-xl font-semibold text-gray-800 block mb-2">C'. ë³€í™”ëœ ê²°ê³¼</label>
                    <textarea id="consequenceC_prime" name="consequenceC_prime" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="ê±´ê°•í•œ ìƒê°ì„ í•˜ë‹ˆ ê¸°ë¶„ì´ë‚˜ í–‰ë™ì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§ˆê¹Œìš”? (ì˜ˆ: ì•„ì‰½ì§€ë§Œ, ë‹¤ìŒì—” ë” ì˜í•  ìˆ˜ ìˆì„ ê±°ì•¼!)"></textarea>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 pt-6">
                    <button type="button" id="previewBtn" class="w-full sm:flex-1 bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg transition-transform duration-150 hover:scale-105 shadow-md">âœ¨ ë¯¸ë¦¬ë³´ê¸°</button>
                    <button type="button" id="completeBtn" class="w-full sm:flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-transform duration-150 hover:scale-105 shadow-md">âœ… ìƒê° ì •ë¦¬í‘œ ì™„ì„±</button>
                    <button type="button" id="resetBtn" class="w-full sm:flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg transition-transform duration-150 hover:scale-105 shadow-md">ğŸ”„ ë‹¤ì‹œ ì“°ê¸°</button>
                </div>
            </form>
        </div>

        <div id="previewModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 transition-opacity duration-300 no-print">
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl relative max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <button id="closeModalBtn" class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-full p-1 w-8 h-8 flex items-center justify-center text-xl font-bold">&times;</button>
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">ë¯¸ë¦¬ë³´ê¸°: ABC ìƒê° ì •ë¦¬í‘œ</h2>
                <div id="printableArea">
                     <div id="resultContentForPrint" class="bg-white rounded-2xl p-6 sm:p-10 border-t-8 border-green-600">
                        </div>
                </div>
                <div class="mt-6 text-center space-y-3 sm:space-y-0 sm:space-x-3">
                    <button type="button" id="printFromModalBtn" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-6 rounded-lg transition shadow-md">ğŸ–¨ï¸ ì¸ì‡„ / PDFë¡œ ì €ì¥</button>
                    <button type="button" id="saveAsImageBtn" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 px-6 rounded-lg transition shadow-md">ğŸ“· ê·¸ë¦¼ íŒŒì¼ë¡œ ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const abcForm = document.getElementById('abcForm');
            const completeBtn = document.getElementById('completeBtn');
            const resetBtn = document.getElementById('resetBtn');
            const hintBtn = document.getElementById('hintBtn');
            const hintBox = document.getElementById('hintBox');
            
            const previewBtn = document.getElementById('previewBtn');
            const previewModal = document.getElementById('previewModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const printFromModalBtn = document.getElementById('printFromModalBtn');
            const saveAsImageBtn = document.getElementById('saveAsImageBtn'); // ìƒˆ ë²„íŠ¼ ì„ íƒ
            const resultContentForPrint = document.getElementById('resultContentForPrint');
            
            const hints = [
                "ë§Œì•½ ê°€ì¥ ì¹œí•œ ì¹œêµ¬ê°€ ë˜‘ê°™ì€ ìƒí™©ì´ë¼ë©´ ë­ë¼ê³  ë§í•´ì¤„ ê±´ê°€ìš”?", "ì´ ìƒê°ì´ 100% ì‚¬ì‹¤ì´ë¼ê³  ì¦ëª…í•  ìˆ˜ ìˆë‚˜ìš”? ë‹¤ë¥¸ ê°€ëŠ¥ì„±ì€ ì—†ì„ê¹Œìš”?", "ìµœì•…ì˜ ê²½ìš°ë§Œ ìƒê°í•˜ê³  ìˆì§„ ì•Šë‚˜ìš”? ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ê°€ì¥ ì¢‹ì€ ê²½ìš°ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", "1ë…„ ë’¤, 5ë…„ ë’¤ì—ë„ ì´ ì¼ì´ ì—¬ì „íˆ ì¤‘ìš”í•˜ê²Œ ëŠê»´ì§ˆê¹Œìš”?", "ì´ ìƒê° ë§ê³  ë‚˜ë¥¼ ë” ê¸°ë¶„ ì¢‹ê²Œ ë§Œë“œëŠ” ë‹¤ë¥¸ ìƒê°ì€ ì—†ì„ê¹Œìš”?", "ëª¨ë“  ì‚¬ëŒì´ ë‚˜ì²˜ëŸ¼ ìƒê°í• ê¹Œìš”? ë‹¤ë¥´ê²Œ ìƒê°í•˜ëŠ” ì‚¬ëŒë„ ìˆì§€ ì•Šì„ê¹Œìš”?"
            ];

            hintBtn.addEventListener('click', () => {
                const randomHint = hints[Math.floor(Math.random() * hints.length)];
                hintBox.textContent = randomHint;
                hintBox.classList.toggle('hidden');
            });

            resetBtn.addEventListener('click', () => {
                abcForm.reset();
                hintBox.classList.add('hidden');
                previewModal.classList.add('hidden');
                resultContentForPrint.innerHTML = '';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            function generateResultHTML(data) {
                return `
                    <div class="text-sm text-gray-500 text-right mb-4">
                        <p>${data.schoolName || 'OOì´ˆë“±í•™êµ'} ${data.className || 'Oí•™ë…„ Oë°˜'} <span class="font-semibold">${data.studentName || 'í™ê¸¸ë™'}</span></p>
                    </div>
                    <header class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800">ABC ìƒê° ì •ë¦¬í‘œ</h2>
                        <p class="text-gray-500 mt-1">${data.studentName || 'OOO'} í•™ìƒì˜ ìƒê°ì„ ëŒì•„ë³´ëŠ” ì‹œê°„</p>
                    </header>
                    <section class="mb-6 p-4 bg-sky-50 rounded-lg shadow">
                        <h3 class="text-xl font-semibold text-sky-700 mb-2 flex items-center">ğŸ¤” ë¶„ì„í•  ìƒí™©</h3>
                        <p class="font-gowun text-gray-800 leading-relaxed">${data.situation || 'ë‚´ìš© ì—†ìŒ'}</p>
                        <p class="text-sm text-sky-600 font-semibold mt-2">ì´ ìƒí™©ì€ ë‚´ê°€ <span class="bg-sky-200 px-2 py-0.5 rounded">[${data.control || 'ì„ íƒ ì•ˆ í•¨'}]</span> ì˜ì—­ì— ìˆë‹¤ê³  ìƒê°í•´ìš”.</p>
                    </section>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <section class="bg-red-50 p-4 rounded-lg shadow border-l-4 border-red-400">
                            <h3 class="text-2xl font-bold text-red-700 text-center mb-4">ğŸ¤¯ ë‚˜ì˜ ìë™ì  ì‚¬ê³ </h3>
                            <div class="space-y-3 font-gowun text-gray-800">
                                <div><strong class="text-red-600">A. ì‚¬ê±´:</strong> <p class="mt-0.5 leading-relaxed">${data.eventA || 'ë‚´ìš© ì—†ìŒ'}</p></div>
                                <div><strong class="text-red-600">B. ìƒê°:</strong> <p class="mt-0.5 leading-relaxed">${data.beliefB || 'ë‚´ìš© ì—†ìŒ'}</p></div>
                                <div><strong class="text-red-600">C. ê²°ê³¼:</strong> <p class="mt-0.5 leading-relaxed">${data.consequenceC || 'ë‚´ìš© ì—†ìŒ'}</p></div>
                            </div>
                        </section>
                        <section class="bg-green-50 p-4 rounded-lg shadow border-l-4 border-green-500">
                            <h3 class="text-2xl font-bold text-green-700 text-center mb-4">ğŸ’¡ ê±´ê°•í•œ ìƒê° ë°”ê¾¸ê¸°</h3>
                            <div class="space-y-3 font-gowun text-gray-800">
                                <div><strong class="text-green-600">A. ì‚¬ê±´:</strong> <p class="mt-0.5 leading-relaxed">${data.eventA || 'ë‚´ìš© ì—†ìŒ'} (ë™ì¼)</p></div>
                                <div><strong class="text-green-600">B'. ë°”ê¾¼ ìƒê°:</strong> <p class="mt-0.5 leading-relaxed">${data.beliefB_prime || 'ë‚´ìš© ì—†ìŒ'}</p></div>
                                <div><strong class="text-green-600">C'. ë³€í™”ëœ ê²°ê³¼:</strong> <p class="mt-0.5 leading-relaxed">${data.consequenceC_prime || 'ë‚´ìš© ì—†ìŒ'}</p></div>
                            </div>
                        </section>
                    </div>
                    <div class="mt-10 text-center text-sm text-gray-500">
                        <p>ì´ í‘œëŠ” ${new Date().toLocaleDateString('ko-KR')}ì— ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }

            function checkFormValidity() {
                const formData = new FormData(abcForm);
                const data = Object.fromEntries(formData.entries());
                const requiredFields = ['schoolName', 'className', 'studentName', 'situation', 'control', 'eventA', 'beliefB', 'consequenceC', 'beliefB_prime', 'consequenceC_prime'];
                const missingField = requiredFields.find(field => !data[field]);
                
                if (missingField) {
                    alert('ëª¨ë“  í•­ëª©ì„ ì±„ì›Œì£¼ì„¸ìš”! ğŸ˜Š (íŒíŠ¸ ì˜† ìƒê°ë„ ì¤‘ìš”í•´ìš”!)');
                    const fieldLabel = document.querySelector(`label[for='${missingField}']`)?.innerText || missingField;
                    const targetElement = document.getElementById(missingField);
                    if (targetElement) {
                        targetElement.focus();
                        targetElement.classList.add('border-red-500', 'ring-red-500');
                        setTimeout(() => { targetElement.classList.remove('border-red-500', 'ring-red-500'); }, 3000);
                    }
                    return false; 
                }
                return data; // ìœ íš¨í•˜ë©´ ë°ì´í„° ë°˜í™˜
            }

            function showPreview() {
                const data = checkFormValidity();
                if (!data) return false;
                
                resultContentForPrint.innerHTML = generateResultHTML(data);
                previewModal.classList.remove('hidden');
                return true;
            }

            previewBtn.addEventListener('click', showPreview);
            
            completeBtn.addEventListener('click', () => {
                showPreview(); // ë¯¸ë¦¬ë³´ê¸° ë¡œì§ í˜¸ì¶œí•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬ ë° ë‚´ìš© ìƒì„± í›„ ëª¨ë‹¬ í‘œì‹œ
            });

            closeModalBtn.addEventListener('click', () => {
                previewModal.classList.add('hidden');
            });

            printFromModalBtn.addEventListener('click', () => {
                window.print();
            });

            // ê·¸ë¦¼ íŒŒì¼ë¡œ ì €ì¥ ê¸°ëŠ¥
            saveAsImageBtn.addEventListener('click', async () => {
                saveAsImageBtn.innerText = 'ê·¸ë¦¼ ì €ì¥ ì¤‘...';
                saveAsImageBtn.disabled = true;

                const elementToCapture = document.getElementById('printableArea');
                if (!elementToCapture) {
                    console.error("Error: Printable area not found for image capture.");
                    saveAsImageBtn.innerText = 'ğŸ“· ê·¸ë¦¼ íŒŒì¼ë¡œ ì €ì¥';
                    saveAsImageBtn.disabled = false;
                    return;
                }
                
                // ë Œë”ë§ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 300));

                try {
                    const canvas = await html2canvas(elementToCapture, {
                        scale: 2, // ë†’ì€ í•´ìƒë„
                        useCORS: true, // ì™¸ë¶€ ì´ë¯¸ì§€ ì‚¬ìš© ì‹œ (ì§€ê¸ˆì€ ì—†ì§€ë§Œ)
                        backgroundColor: '#ffffff' // ë°°ê²½ìƒ‰ í°ìƒ‰ìœ¼ë¡œ ì§€ì •
                    });
                    const imageUrl = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.href = imageUrl;
                    link.download = 'abc_ìƒê°ì •ë¦¬í‘œ.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (error) {
                    console.error("Error generating image:", error);
                    alert("ê·¸ë¦¼ íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                } finally {
                    saveAsImageBtn.innerText = 'ğŸ“· ê·¸ë¦¼ íŒŒì¼ë¡œ ì €ì¥';
                    saveAsImageBtn.disabled = false;
                }
            });
        });
    </script>
</body>
</html>
